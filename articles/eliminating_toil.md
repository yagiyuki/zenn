---
title: "トイル撲滅の刃"
emoji: "👿"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["効率化", "SRE", "運用"]
published: true
---


この記事では、エンジニアの業務におけるトイルの解説とトイル撲滅のアイディアをまとめています。

この記事では、「SRE サイトリライアビリティエンジニアリング ――Googleの信頼性を支えるエンジニアリングチーム」の
「5章 トイルの撲滅」の内容をベースに書いてみます。

https://www.oreilly.co.jp/books/9784873117911/

書籍には記載されていない**トイル撲滅の具体的な手段**を考察して書いています。

本はSRE向けに書かれていますが、トイル自体はSREに携わるエンジニアだけが抱える問題ではありません。
(つまり、ほぼ全てのエンジニアに役立つ内容のはず！)

この記事を読み、トイル撲滅の刃を持ち、効率的にエンジニアの仕事を進めて行きましょう。

## トイル(Toil)とは

トイル(Toil)とは直訳で「苦しい仕事」、「骨折り」、「苦労」などという意味になります。

この説明を聞くと単に苦しい仕事=トイルに思えますが、SREにおけるトイルは少し違います。
後ほど説明しますが、以下の項目はトイルにはあたりません。

* 管理上の雑務(オーバーヘッド)
* つまらないかもしれないが長期的に価値がある仕事

SRE上のトイルは、プロダクションサービスを動作させることに関するもののうち以下の傾向を持つものです。

* 手作業であり、繰り返されることであり、自動化できること
* 割り込み作業
* 長期的な価値を持たない
* 作業量がサービス成長に比例すること

1つ以上該当すれば、トイルである可能性があります。
ただし、前提としてトイルは苦しい仕事であることを指すため、上に該当することでも

* エンジニア本人が苦しくなければ、その人にとってはトイルではない
* チーム全員が苦しくなければ、そのチームにとってはトイルでない

ということになります。

### 手作業であり、繰り返されることであり、自動化できること

ある作業をするのが初めてで or 2回目くらいまでであれば、トイルではないです。
また、人間の判断が必要で自動化できないこともトイルではないです。

上記に該当しないタスクは、トイルである可能性が高いでしょう。
注意点として、単に作業を自動化するだけではトイルを解消したとは言いません。
スクリプトを走らせるたけの実作業に人間が使う時間は、トイルの時間と言えるからです。
定期的に動作させる必要があるスクリプトは、cronやrundeckなどのジョブ管理ツールなどで定期実行させる
ことではじめてトイルを解消できたといえるでしょう。

### 割り込み作業 [^1]

割り込み作業はだいたいトイルです。

具体的には、

* システムのアラート通知にともなう対応
* サービス運用に関する問い合わせ

個人的にはこれが一番滅したいトイルです。
とくに緊急であればあるほどストレスです。

この種のトイルは、完全に無くすことはできないですが、極力無くすべきです。
例えば、アラート通知については自動復旧するしくみを作るなので減らしていけそうです。


### 長期的な価値を持たない

あるタスクを終えたあとでも、サービスが同じ状態のままなのであれば、そのタスクはおそらくトイルです。

例えば、

* 新規のAPI開発をしたが利用者がいない
* あるプロダクトに高度な仕組み(AIなど)を導入したがプロダクト自体の改善は見られない

などが当てはまりそうです。

サービスが同じ状態は表面だけでなく、内部的な状態も指しています。

例えば、コードリファクタリングなどは、サービスの見た目には変化を及ぼしませんが、
長期的な価値を持つ改善にあたるので、トイルとはいわないです。


### 作業量がサービス成長に比例すること

サービスのトラッフィクやユーザー数に比例して、何かしらの作業が発生するならばトイルです。

これはわかりやすいですが、一応具体例をいっておくと、

* トラフィックやユーザに比例してシステムのリソースを拡充する
* トラフィックやユーザに比例してAPIの設定を変える必要がある

といったところになります。

少なくともトラフィックやユーザー数が10倍になっても耐えられる設計をすべきだと書籍には書いてありました。


## SRE上のトイルにはならないもの

以下、2点は人によっては苦しい仕事になるかもしれないですが、SRE上のトイルではありません。

### 管理上の雑務(オーバーヘッド)

管理上の雑務はSREにおけるトイルではありません。

* 採用関連
* 事務作業(例:交通費精算)
* 作業計画の設定

これらは、トイルとはオーバーヘッドと呼ばます。

### つまらないかもしれないが長期的に価値がある仕事

つまなかったり、苦しかったりする仕事でも長期的に価値を生む可能性がある仕事があります。

例えば、

* システムのアラート設定
* データ更新のジョブのスケジュール設定

など、これらは多くのエンジニアにとっては退屈でつまらない仕事でしょう。
しかし、実施することで安全で効率的なシステム運用ができるので長期的な価値を生む仕事といえます。


## トイルはメンバー間で偏らないように

GoogleのSREチームはトイルは50%以下に抑えて、
残りはトイルの削減やサービスの機能追加等のエンジニアリング業務にあてているそうです。

なので自分の業務、できればチームの業務全体で

* 自分たちの作業でトイルに当たる業務
* トイルにかけている時間

を洗い出すところから始めるとよいと思います。
そのうえで、「」で書いたような方法でトイル削減に取り組んでみるとよいです。

また、私個人としてはトイルにかける時間以上にメンバー間でのトイル負荷を均一化することが大事だと考えます。
トイルは性質上経験を積んだエンジニアに偏る傾向があります。
とくに緊急を要する問い合わせ対応などはその典型です。

特定のメンバーにトイルが偏ると、メンバー間の摩擦につながります。
また、トイルが偏ったメンバーの退職リスクもありそうです。

そうならないためにもトイルはメンバー間で極力均一になることが求められます。

書籍にも書かれているのですが、サービスの問い合わせ対応などはメンバー間でローテションを組むなどするとよさそうです。


## トイルは常に悪か?

結論は常に悪ではないです。
冒頭で説明した通り、トイルを直訳すると「苦しい仕事」なので、
手作業や繰り返しの作業でも「苦しい仕事」に該当しなければ、トイルではありません。

とくに

* 少量のタスク
* 予測可能なタスク

であればトイルの度合いは低くなるといえます。

ただし、どのくらいの量のトイルが負担になるかは人それぞれです。
チーム開発においては、認識合わしたうえで、解決すべきトイルに優先度をつけられるとよさそうです。

## まとめ

SREのトイルやトイル削減のアプローチについて解説しました。
SREの本をベースに書いたので、サービス運用に携わるエンジニア視点の話が多かったとおもます。

しか、サービス運用にたずさわらずとも、何かしらのトイルを抱えているのエンジニアは多いのではないでしょうか。

トイルという鬼を滅して楽しいエンジニアライフを送りましょう！

以上です。
[^1]: 書籍では戦術的であることと表現されていますが、やや難解であったため単に割り込み作業としました。
